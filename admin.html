<!DOCTYPE html>
<html>
    <style>
        .table1{
            cellspacing: 0px;
            cellpadding: 0px;
            border: 0px;
            width: 325px;
        }
        .table2{
            cellspacing: 0px;
            cellpadding: 1px;
            border: 1px;
            width: 300px;
        }
        .row{
            color: white;
            background-color: grey;
        }
        .div{
            width: 320px;
            height: 60px;
            overflow: auto;
        }
    </style>
    <head>
        <title>Restaurant Admin</title>
        <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
        <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
        <script src="http://code.jquery.com/ui/1.11.0/jquery-ui.js"></script>
        <script src="http://www.datejs.com/build/date.js" type="text/javascript"></script>
        <script src="admin.js" type="text/javascript"></script>
        <script src="booking.js" type="text/javascript"></script>
        <script>

function getAdminTimes() {
    var date = document.getElementById("datepicker").value;
    var size = document.getElementById("size").value;
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            var response = JSON.parse(this.responseText);
            var len, i, text;
            len = response.Timeslots.length;
            text = "";
            for (i = 0; i < len; i++) {
                text += "<tr><td><button onclick=\"book('" + response.Timeslots[i] + "','" + size + "')\">Book for " + response.Timeslots[i] + "</button></td></tr>";
            }
            document.getElementById("output").innerHTML = "<input type='hidden' id='datepicker' value='" + date + "'/><input type='hidden' id='email' value='Restaurant'/><br/><table>" + text + "</table>";
            document.getElementById("status").innerHTML = "" + len + " available slots for " + size + " people on " + date + ". Click on time to reserve for phone booking";
        }
    };
    xhttp.open("GET", "https://msjhgasjyb.execute-api.eu-west-2.amazonaws.com/beta/demo/website?Size=" + size + "&Date=" + convertToISODate(date), true);
    xhttp.setRequestHeader("Content-type", "application/json");

    xhttp.send();
}
function getAll() {
    var date = document.getElementById("datepicker").value;
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            var response = JSON.parse(this.responseText);
            var len, i, text;
            text = "";
            len = response.length;
            for (i = 0; i < len; i++) {
                text += "<tr><td>" + response[i].Time +
                    "</td><td>" + response[i].Size +
                    "</td><td>" + response[i].Email + "</td></tr>";
            }
            document.getElementById("output").innerHTML = "<table><tr><th>Time</th><th>Size</th><th>Email</th></tr>" + text + "</table>";
            document.getElementById("status").innerHTML = "" + len + " bookings found for " + date;
        }
    };
    xhttp.open("GET", "https://msjhgasjyb.execute-api.eu-west-2.amazonaws.com/beta/demo/website?Date=" + convertToISODate(date), true);
    xhttp.setRequestHeader("Content-type", "application/json");

    xhttp.send();
}
function setDatePicker(id) {
    $( id ).datepicker();
    $( id ).datepicker( "option", "dateFormat", "dd MM yy" );
    $( id ).datepicker( "option", "minDate", 0);
//    $( id ).datepicker( "option", "maxDate", new Date(2017, 7, 20) );
}
function init() {

    initData();
    setDatePicker("#datepicker");
    addCanvasEvents();
    inside();

}

function logme(id) {
    console.log("logging:"+id);
}
        </script>

    </head>
    <body onload="init()">
    <h1>Restaurant Admin Interface</h1>
    <table><tr><td>Date:</td><td><input type='text' name='selected_date' id='datepicker'/></td>
        <td><button onclick='getAll()'>Show All Bookings</button></td>
        <td><button onclick='inside()'>View Inside</button></td>
        <td><button onclick='outside()'>View Outside</button></td></tr>
        <tr><td colspan='4' rowspan='4'><canvas width='500' height='550' id='floorplan'  style='border:1px solid #d3d3d3;'>You must use a supported browser, such as Chrome</canvas></td>
            <td id='detail_table_id'>Table Number: 4</td></tr>
        <tr><td>blah</td></tr>
        <tr><td id='detail_time'>Time: 18:30</td></tr>
        <tr><td>Comment: blah</td></tr>
    </table>
    <table id="Table1", class="table1">
    </table>
    <p id="status"></p>
    <p id="output"></p>
    </body>
</html>

